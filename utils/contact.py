"""
æ–‡ä»¶ç›®çš„: è”ç³»æ–¹å¼è¯†åˆ«ä¸æ ¼å¼åŒ–å·¥å…·æ¨¡å—
ä½œè€…: Zhu Rongpeng
åˆ›å»ºæ—¥æœŸ: 2025-10-16

åŠŸèƒ½æè¿°:
    è¯†åˆ«ä¸åŒç±»å‹çš„è”ç³»æ–¹å¼ï¼ˆé‚®ç®±ã€æ‰‹æœºå·ã€QQå·ç­‰ï¼‰
    ä¸ºæ¯ç§ç±»å‹ç”Ÿæˆç›¸åº”çš„å¯ç‚¹å‡»é“¾æ¥æˆ–æ˜¾ç¤ºæ ¼å¼
    æ”¯æŒåè®®: mailto:, tel:, tencent://
"""

import re

# ==================== å…¨å±€å¸¸é‡ ====================
# é‚®ç®±æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼
EMAIL_PATTERN = r"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"

# æ‰‹æœºå·æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼ˆä¸­å›½å¤§é™†11ä½ï¼‰
PHONE_PATTERN = r"^1[3-9]\d{9}$"

# QQå·æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ï¼ˆ5-11ä½æ•°å­—ï¼‰
QQ_PATTERN = r"^\d{5,11}$"


# ==================== ä¸»è¦åŠŸèƒ½å‡½æ•° ====================


def format_contact(contact):
    """
    è¯†åˆ«è”ç³»æ–¹å¼ç±»å‹å¹¶è¿”å›æ ¼å¼åŒ–çš„ HTML

    åŠŸèƒ½è¯´æ˜:
        è‡ªåŠ¨è¯†åˆ«è”ç³»æ–¹å¼çš„ç±»å‹ï¼ˆé‚®ç®±/æ‰‹æœº/QQç­‰ï¼‰ï¼Œå¹¶ç”Ÿæˆ
        å¸¦æœ‰ç›¸åº”åè®®é“¾æ¥çš„ HTML ä»£ç ï¼Œæ”¯æŒä¸€é”®æ‰“å¼€å¯¹åº”åº”ç”¨

    è¾“å…¥å‚æ•°:
        contact (str): ç”¨æˆ·è¾“å…¥çš„è”ç³»æ–¹å¼å­—ç¬¦ä¸²
                      ä¾‹å¦‚: "example@qq.com", "13800138000", "123456789"

    è¿”å›å€¼:
        str: æ ¼å¼åŒ–çš„ HTML ä»£ç ï¼ŒåŒ…å«:
             - å¯ç‚¹å‡»çš„é“¾æ¥ï¼ˆä½¿ç”¨å¯¹åº”åè®®ï¼‰
             - å›¾æ ‡å’Œæç¤ºæ–‡æœ¬
             - CSS ç±»åç”¨äºæ ·å¼æ§åˆ¶

    è¯†åˆ«è§„åˆ™:
        1. é‚®ç®±: åŒ…å« @ ç¬¦å·ï¼Œç¬¦åˆé‚®ç®±æ ¼å¼
        2. æ‰‹æœº: 11ä½æ•°å­—ï¼Œä»¥1å¼€å¤´ï¼Œç¬¬äºŒä½ä¸º3-9
        3. QQå·: 5-11ä½çº¯æ•°å­—
        4. å…¶ä»–: ä½œä¸ºæ™®é€šæ–‡æœ¬æ˜¾ç¤ºï¼ˆå¦‚å¾®ä¿¡å·ï¼‰

    åè®®è¯´æ˜:
        - mailto: é‚®ä»¶åè®®ï¼Œæ‰“å¼€é»˜è®¤é‚®ä»¶å®¢æˆ·ç«¯
        - tel: ç”µè¯åè®®ï¼Œç§»åŠ¨ç«¯æ‹¨æ‰“ç”µè¯
        - tencent: QQç§æœ‰åè®®ï¼Œæ‰“å¼€QQä¸´æ—¶ä¼šè¯

    ç¤ºä¾‹:
        >>> format_contact("admin@example.com")
        '<div class="contact-info">
            <a href="mailto:admin@example.com" ...>ğŸ“§ admin@example.com</a>
        </div>'

        >>> format_contact("13800138000")
        '<div class="contact-info">
            <a href="tel:13800138000" ...>ğŸ“ 13800138000</a>
        </div>'
    """
    # æ¸…é™¤é¦–å°¾ç©ºæ ¼
    contact = contact.strip()

    # åˆ¤æ–­æ˜¯å¦ä¸ºé‚®ç®±
    # åè®®: mailto:
    # åŸç†: å½“ä¸€ä¸ª <a> æ ‡ç­¾çš„ href å±æ€§ä»¥ mailto: å¼€å¤´æ—¶ï¼Œæµè§ˆå™¨ä¼šè°ƒç”¨æ“ä½œç³»ç»Ÿé»˜è®¤çš„é‚®ä»¶å®¢æˆ·ç«¯ï¼ˆå¦‚ Windows çš„é‚®ä»¶ã€Outlook æˆ– Foxmailï¼‰ï¼Œå¹¶è‡ªåŠ¨å°† mailto: åé¢çš„åœ°å€å¡«å…¥æ”¶ä»¶äººã€‚
    email_pattern = r"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
    if re.match(email_pattern, contact):
        return f"""
        <div class="contact-info">
            <a href="mailto:{contact}" class="contact-link email" title="å‘é€é‚®ä»¶">
                ğŸ“§ {contact}
            </a>
            <span class="copy-hint">(æ¨èä½¿ç”¨Outlook)</span>
        </div>
        """

    # åˆ¤æ–­æ˜¯å¦ä¸ºæ‰‹æœºå·ï¼ˆ11ä½æ•°å­—ï¼‰
    # åè®®: tel:
    # åŸç†: tel: åè®®ä¸»è¦ç”¨äºç§»åŠ¨è®¾å¤‡ã€‚åœ¨æ‰‹æœºä¸Šç‚¹å‡»ä¸€ä¸ª tel: é“¾æ¥ï¼Œä¼šç›´æ¥è·³è½¬åˆ°æ‹¨å·ç•Œé¢ï¼Œå¹¶å°†å·ç é¢„å¡«å†™å¥½ã€‚åœ¨æ¡Œé¢ä¸Šï¼Œè¡Œä¸ºåˆ™ä¸ç»Ÿä¸€ï¼Œå¯èƒ½ä¼šæç¤ºç”¨ Skype æˆ–å…¶ä»–ç½‘ç»œç”µè¯åº”ç”¨æ‰“å¼€ã€‚
    phone_pattern = r"^1[3-9]\d{9}$"
    if re.match(phone_pattern, contact):
        return f"""
        <div class="contact-info">
            <a href="tel:{contact}" class="contact-link phone" title="æ‹¨æ‰“ç”µè¯">
                ğŸ“ {contact}
            </a>
        </div>
        """

    # åˆ¤æ–­æ˜¯å¦ä¸ºQQå·ï¼ˆ5-11ä½æ•°å­—ï¼‰
    # åè®®: tencent:// (è¿™æ˜¯ QQ çš„ç§æœ‰åè®®)
    # åŸç†: å¦‚æœç”¨æˆ·çš„ç”µè„‘ä¸Šå®‰è£…äº† QQï¼Œç‚¹å‡»è¿™ä¸ªé“¾æ¥å°±ä¼šå”¤èµ· QQ å®¢æˆ·ç«¯ï¼Œå¹¶æ‰“å¼€ä¸æŒ‡å®š QQ å·ç çš„ä¸´æ—¶èŠå¤©çª—å£ã€‚å¦‚æœæ²¡å®‰è£…ï¼Œåˆ™æ— ååº”ã€‚
    # HTML ç¤ºä¾‹: <a href="tencent://message/?uin=123456789&Site=item_revival&Menu=yes">ç‚¹å‡»ä¸ QQ:123456789 èŠå¤©</a>
    # uin åé¢è·Ÿçš„æ˜¯ QQ å·ã€‚Site å’Œ Menu æ˜¯é™„åŠ å‚æ•°ï¼Œå¯ä»¥ä¿ç•™ã€‚
    qq_pattern = r"^\d{5,11}$"
    if re.match(qq_pattern, contact):
        return f"""
        <div class="contact-info">
            <a href="tencent://message/?uin={contact}&Site=&Menu=yes" class="contact-link qq" title="é€šè¿‡QQè”ç³»">
                ğŸ’¬ QQ: {contact}
            </a>
            <span class="copy-hint">(ç‚¹å‡»æ‰“å¼€QQï¼Œéœ€å®‰è£…å®¢æˆ·ç«¯)</span>
        </div>
        """

    # ========== å…¶ä»–æƒ…å†µï¼ˆå¾®ä¿¡å·ç­‰ï¼‰ ==========
    return f"""
    <div class="contact-info">
        <span class="contact-text">
            ğŸ“± {contact}
        </span>
    </div>
    """
